#!/usr/bin/env python
from os import environ
from os.path import join
from glob import iglob
from pbs import queue
queue = queue()
queue.verbose = True
nodes = 12
walltime = '336:00:00'

try: topdir = environ['BOSS_SPECTRO_REDUX']
except: topdir = None
try: run2d = environ['RUN2D']
except: run2d = None
platedir = join(topdir,run2d,'*') if topdir and run2d else None

plates=[]
mjds=[]
if platedir:
    for p in iglob(platedir):
        try: plate = int(p)
        except: plate = None
        if plate:
        



queue.create(label='zfind',alloc='sdss-kp',nodes=nodes,ppn=16,walltime=walltime)
for i,plate in enumerate(plates): queue.append("zfind -p %i -m %i " % (plate,mjds[i]))
queue.commit(hard=True,submit=True)
